<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Cambios - Torre Triana</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f0f2f5; }
        .container { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #0038b8; border-bottom: 2px solid #0038b8; padding-bottom: 10px; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        select, input { width: 100%; padding: 12px; margin-top: 5px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        .manual-name { display: none; margin-top: 10px; border: 1px solid #0038b8; }
        .status { margin-top: 25px; text-align: center; font-size: 1.3em; color: #28a745; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn-pdf { flex: 3; padding: 15px; background-color: #0038b8; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-borrar { flex: 1; padding: 15px; background-color: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9em; }
        footer { margin-top: 30px; text-align: center; font-size: 0.8em; color: #777; border-top: 1px solid #eee; padding-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Control Torre Triana</h2>
    
    <label>V.S. 1 (Cede turno):</label>
    <select id="vs1" onchange="checkManual('vs1', 'manual1')">
        <option>JOSE ANTONIO VARGAS</option>
        <option>ANTONIO ZAMORA GÓMEZ</option>
        <option>MANUEL MORENO</option>
        <option>FRANCISCO JAVIER</option>
        <option>JUAN MANUEL</option>
        <option>ALBERTO RODRÍGUEZ</option>
        <option>DAVID GARCÍA</option>
        <option>MIGUEL ÁNGEL</option>
        <option>JOSÉ LUIS</option>
        <option>RAFAEL MARTÍN</option>
        <option>FERNANDO JOSÉ</option>
        <option>ANTONIO JESÚS</option>
        <option>CARLOS JAVIER</option>
        <option>JOSÉ MANUEL</option>
        <option>ÁNGEL LUIS</option>
        <option>DIEGO JOSÉ</option>
        <option value="OTRO">-- OTRO (Añadir manual) --</option>
    </select>
    <input type="text" id="manual1" class="manual-name" placeholder="Escribe nombre completo">

    <label>Día y Turno:</label>
    <input type="text" id="turno1" placeholder="Ej: Mañana - 22/02">

    <label>V.S. 2 (Realiza turno):</label>
    <select id="vs2" onchange="checkManual('vs2', 'manual2')">
        <option>ANTONIO ZAMORA GÓMEZ</option>
        <option>JOSE ANTONIO VARGAS</option>
        <option>MANUEL MORENO</option>
        <option>FRANCISCO JAVIER</option>
        <option>JUAN MANUEL</option>
        <option>ALBERTO RODRÍGUEZ</option>
        <option>DAVID GARCÍA</option>
        <option>MIGUEL ÁNGEL</option>
        <option>JOSÉ LUIS</option>
        <option>RAFAEL MARTÍN</option>
        <option>FERNANDO JOSÉ</option>
        <option>ANTONIO JESÚS</option>
        <option>CARLOS JAVIER</option>
        <option>JOSÉ MANUEL</option>
        <option>ÁNGEL LUIS</option>
        <option>DIEGO JOSÉ</option>
        <option value="OTRO">-- OTRO (Añadir manual) --</option>
    </select>
    <input type="text" id="manual2" class="manual-name" placeholder="Escribe nombre completo">

    <label>Día y Turno:</label>
    <input type="text" id="turno2" placeholder="Ej: Noche - 25/02">

    <div class="status">Estado: <strong>Ok</strong></div>

    <div class="btn-group">
        <button class="btn-pdf" onclick="generarPDF()">GENERAR PDF SELLADO</button>
        <button class="btn-borrar" onclick="confirmarBorrado()">BORRAR</button>
    </div>

    <footer>Powered by HebreoSystems.</footer>
</div>

<script>
    function checkManual(selectId, manualId) {
        const select = document.getElementById(selectId);
        const manualInput = document.getElementById(manualId);
        manualInput.style.display = (select.value === 'OTRO') ? 'block' : 'none';
    }

    function confirmarBorrado() {
        let pin = prompt("Introduce el código de seguridad para borrar:");
        if (pin === "116768") {
            location.reload();
        } else {
            alert("Código incorrecto. Los datos están protegidos.");
        }
    }

    async function generarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        let n1 = document.getElementById('vs1').value;
        if(n1 === 'OTRO') n1 = document.getElementById('manual1').value.toUpperCase();
        let n2 = document.getElementById('vs2').value;
        if(n2 === 'OTRO') n2 = document.getElementById('manual2').value.toUpperCase();

        const t1 = document.getElementById('turno1').value;
        const t2 = document.getElementById('turno2').value;
        const fechaActual = new Date().toLocaleString();

        // Datos del documento
        doc.setFontSize(16);
        doc.text("SOLICITUD CAMBIO DE TURNO - TORRE TRIANA", 20, 25);
        doc.setFontSize(12);
        doc.text(`D. ${n1}`, 20, 45);
        doc.text(`REALIZA TURNO/S: ${t1}`, 20, 55);
        doc.text(`D. ${n2}`, 20, 75);
        doc.text(`REALIZA TURNO/S: ${t2}`, 20, 85);
        
        doc.setFont(undefined, 'bold');
        doc.text("Estado: Ok", 20, 105);
        doc.setFont(undefined, 'normal');

        // Generar Sello
        const canvas = document.createElement('canvas');
        canvas.width = 300; canvas.height = 300;
        const ctx = canvas.getContext('2d');

        const grad = ctx.createLinearGradient(50, 50, 250, 250);
        grad.addColorStop(0, '#0038b8'); grad.addColorStop(0.5, '#ffffff'); grad.addColorStop(1, '#0038b8');
        ctx.fillStyle = grad;
        ctx.beginPath(); ctx.arc(150, 150, 110, 0, Math.PI * 2); ctx.fill();

        ctx.strokeStyle = '#0038b8'; ctx.lineWidth = 8;
        ctx.beginPath(); ctx.arc(150, 150, 125, 0, Math.PI * 2); ctx.stroke();
        
        ctx.fillStyle = '#0038b8'; ctx.font = 'bold 22px Arial'; ctx.textAlign = 'center';
        ctx.fillText("TORRE TRIANA", 150, 75);
        ctx.fillText("SEGURIDAD", 150, 235);

        ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
        ctx.font = 'bold 20px Arial';
        ctx.save();
        ctx.translate(150, 150); ctx.rotate(-0.4);
        ctx.fillText("DOCUMENTO FIRMADO", 0, -10);
        ctx.fillText("DIGITALMENTE", 0, 20);
        ctx.restore();

        const imgData = canvas.toDataURL('image/png');
        doc.addImage(imgData, 'PNG', 130, 110, 60, 60);

        doc.setFontSize(9);
        doc.text(`Documento validado digitalmente por Torre Triana el ${fechaActual}`, 20, 275);
        doc.text("Powered by HebreoSystems.", 20, 282);

        doc.save(`Cambio_Triana_${n1}.pdf`);
    }
</script>

</body>
</html>
